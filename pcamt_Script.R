install.packages("AppliedPredictiveModeling")
install.packages("dplyr")
install.packages("tidyr")
install.packages("Correlplot")
install.packages("lattice")
install.packages("caret")
library(lattice)
library(AppliedPredictiveModeling)
library(dplyr)
library(tidyr)
library(ggplot2)
library(corrplot)
library(caret)
library(e1071)

Kdatafinal <- read.csv("C:/R projects/OR-568 - Spring 2023/Malware detection project/Kaggle-data-FINAL.csv")
View(Kdatafinal)
str(Kdatafinal)
nearZeroVar(Kdatafinal)
# I am removing md5
malwaredf<- Kdatafinal[, -2]
malwaredf
str(malwaredf)
# Find out the lenght of the data frame
print(length(malwaredf))
#cor(malwaredf)
#CorrPlot <- cor(malwaredf)
#corrplot
# PCA analysis
#find out the mean of cor(malwaredf)
#1. Check PCA eligibility. After running the mean, I got 0.0423 as result which
#is high;therefore it is eligible for PCA
mean(cor(malwaredf)) # mean checks for the avg correlaion between the variables.
#2. Principal Component Analysis
malwarePCA = princomp(malwaredf)
#It shows that the correlation between variables and the loading creation should equal                to the variables
malwarePCA$loadings

#Create an object (PCmalware) to check if variables are dependent or not.If they are
#independent the correlation among the components must be zero or must be nearly zero.
pcmalware = malwarePCA$scores

View(pcmalware)
summary(pcmalware)
#cor(pcmalware)
#Running skeweness to all the dataset (malwaredf)
skewValues <- apply(malwaredf,2,skewness)
skewness(malwaredf$ResourcesMeanEntropy)
library(caret)
#I have to convert the dataset to as.numerci so the BoxCoxTrans works. 
#Malwaredfboxcox <- BoxCoxTrans(malwaredf)
#Running the PCA for the entire final data set
pcaM <- prcomp(malwaredf, center=TRUE, scale. = TRUE )
#Running the PCA for the whole set minus the id column, so c(2:56).
#I can tell that there is 5 elements and its size is 95.2 MB, 2M smaller than the pcaM.
pcaM1<-prcomp(malwaredf [c(2:56)], center=TRUE, scale. = TRUE)
#Calculate the cumulative percentage of variance which each component accounts for.The PCA object for
#the Malwaredataset is pcaM1 (does not contain the ID column).
# Need to do research on how to read this percentages
percentVarMalware <- pcaM1$sd^2/sum(pcaM1$sd^2)*100 
percentVarMalware[2:56]
#The another sub-object called rotation stores the variable loadings, where  rows correspond to 
#predictor variables and columns are associated with the  components.

head(pcaM1$rotation[, 1:5])
library(corrplot)


#Running correlatioin for the predictors
corrMalwaredf <- cor(malwaredf)
dim(corrMalwaredf)
#Visualize the correlation structure of the data. A heatmap cor was created by Matt instead of this one. 
corrplot(corrMalwaredf, order="hclust")
# filtering hig correlations, cutoff = 0.85
highCorr <- findCorrelation(corrMalwaredf, cutoff = .85)

length(highCorr)
head(highCorr)
filteredMalwaredf <- malwaredf[, -highCorr]#Filtering the highcorr variables, the data set gets 
#down to 48 variables.

# I will be using factoextra package to create a ggplot2-based for visualization
install.packages("factoextra")
library(factoextra)
#pcaM <- prcomp(malwaredf, scale = TRUE)
#Visualize eigenvalues (scree plot). 
fviz_eig(pcaM)
#Biplot of individuals and variables
fviz_pca_biplot(pcaM, repel = TRUE,
                col.var = "#2E9FDF", # Variables color
                col.ind = "#696969"  # Individuals color
)

# Eigenvalues
eig.val <- get_eigenvalue(pcaM)
eig.val


